- name : Define expdp filename
  set_fact:
    file_suffix: "{{ db_version }}_{{ patch.base_ru | default('') }}{{ patch.type }}_{{ patch.id }}"
    dump_file_prefix: "tables_{{ db_version }}_{{ patch.base_ru | default('') }}{{ patch.type }}_{{ patch.id }}"

- name: "Check if {{ output_folder }}/expdp/{{ dump_file_prefix }}.dmp exists"
  stat:
    path: "{{ output_folder }}/expdp/{{ dump_file_prefix }}.dmp"
  register: dump_stat_result

- name: "Copy {{ dump_file_prefix }}.dmp to shared_folder"
  copy:
    src: "{{ output_folder }}/expdp/{{ dump_file_prefix }}.dmp"
    dest: "{{ shared_folder }}"
  when: dump_stat_result.stat.exists